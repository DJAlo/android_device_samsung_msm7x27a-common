From 2615207c7540fafa05e9cb267227738028d61873 Mon Sep 17 00:00:00 2001
From: TheWhisp <daavis.90@gmail.com>
Date: Sun, 10 Nov 2013 17:42:43 +0200
Subject: [PATCH 2/2] add qcom fm support

Change-Id: I7f65aea4760cd047d08e95e1a06df6536490069f
---
 include/hardware/audio.h        |  5 +++++
 include/hardware/audio_policy.h |  8 ++++++++
 include/hardware/hardware.h     | 16 +++++++++++++++-
 3 files changed, 28 insertions(+), 1 deletion(-)

diff --git a/include/hardware/audio.h b/include/hardware/audio.h
index d100195..5f7359d 100644
--- a/include/hardware/audio.h
+++ b/include/hardware/audio.h
@@ -599,6 +599,11 @@ struct audio_hw_device {
      */
     int (*get_master_volume)(struct audio_hw_device *dev, float *volume);
 
+#ifdef QCOM_FM_ENABLED
+    /** set the fm audio volume. Range is between 0.0 and 1.0 */
+    int (*set_fm_volume)(struct audio_hw_device *dev, float volume);
+#endif
+
     /**
      * set_mode is called when the audio mode changes. AUDIO_MODE_NORMAL mode
      * is for standard audio playback, AUDIO_MODE_RINGTONE when a ringtone is
diff --git a/include/hardware/audio_policy.h b/include/hardware/audio_policy.h
index 4e75e02..ff570ea 100644
--- a/include/hardware/audio_policy.h
+++ b/include/hardware/audio_policy.h
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2011 The Android Open Source Project
+ * Copyright (c) 2012, Code Aurora Forum. All rights reserved.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -375,6 +376,13 @@ struct audio_policy_service_ops {
                         audio_io_handle_t src_output,
                         audio_io_handle_t dst_output);
 
+#ifdef QCOM_FM_ENABLED
+    /* set fm audio volume. */
+    int (*set_fm_volume)(void *service,
+                         float volume,
+                         int delay_ms);
+#endif
+
     /* loads an audio hw module.
      *
      * The module name passed is the base name of the HW module library, e.g "primary" or "a2dp".
diff --git a/include/hardware/hardware.h b/include/hardware/hardware.h
index 416ae39..37a5a15 100644
--- a/include/hardware/hardware.h
+++ b/include/hardware/hardware.h
@@ -33,7 +33,21 @@ __BEGIN_DECLS
 
 #define HARDWARE_MODULE_TAG MAKE_TAG_CONSTANT('H', 'W', 'M', 'T')
 #define HARDWARE_DEVICE_TAG MAKE_TAG_CONSTANT('H', 'W', 'D', 'T')
-
+#ifdef QCOM_HARDWARE
+#define IS_TARGET_MPQ(status) \
+{ \
+    int id = 0; \
+    FILE *fp; \
+    if ((fp = fopen("/sys/devices/system/soc/soc0/id", "r")) != NULL) { \
+        fscanf(fp, "%d", &id); \
+        fclose(fp); \
+    } \
+    if (id == 130) \
+        status = 1; \
+    else \
+        status = 0;\
+}
+#endif
 #define HARDWARE_MAKE_API_VERSION(maj,min) \
             ((((maj) & 0xff) << 8) | ((min) & 0xff))
 
-- 
1.8.1.2

