From d9586dc8d172fe9b7a3c812acc53d4a406764092 Mon Sep 17 00:00:00 2001
From: TheWhisp <daavis.90@gmail.com>
Date: Tue, 3 Dec 2013 17:36:20 +0200
Subject: [PATCH] init: detect lpm bootmode

Change-Id: Id44663d6293543f585a041a903ada67ddfade275
---
 init/init.c | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/init/init.c b/init/init.c
index fe7dbba..f5eb288 100755
--- a/init/init.c
+++ b/init/init.c
@@ -74,6 +74,11 @@ static int   bootchart_count;
 #define BOARD_CHARGING_CMDLINE_VALUE "true"
 #endif
 
+#ifndef BOARD_LPM_BOOT_ARGUMENT_NAME
+#define BOARD_LPM_BOOT_ARGUMENT_NAME "lpm_boot"
+#define BOARD_LPM_BOOT_ARGUMENT_VALUE "1"
+#endif
+
 static char console[32];
 static char bootmode[32];
 static char hardware[32];
@@ -108,6 +113,8 @@ static const char *ENV[32];
 
 static unsigned emmc_boot = 0;
 
+static unsigned lpm_bootmode = 0;
+
 static unsigned charging_mode = 0;
 
 /* add_environment - add "key=value" to the current environment */
@@ -663,6 +670,10 @@ static void import_kernel_nv(char *name, int for_emulator)
         if (!strcmp(value,"true")) {
             emmc_boot = 1;
         }
+    } else if (!strcmp(name,BOARD_LPM_BOOT_ARGUMENT_NAME)) {
+        if (!strcmp(value,BOARD_LPM_BOOT_ARGUMENT_VALUE)) {
+            lpm_bootmode = 1;
+        }
     } else if (!strcmp(name,BOARD_CHARGING_CMDLINE_NAME)) {
         strlcpy(battchg_pause, value, sizeof(battchg_pause));
     } else if (!strncmp(name, "androidboot.", 12) && name_len > 12) {
@@ -894,7 +905,7 @@ void selinux_load_policy(void)
 static int charging_mode_booting(void)
 {
 #ifndef BOARD_CHARGING_MODE_BOOTING_LPM
-	return 0;
+    return lpm_bootmode;
 #else
 	int f;
 	char cmb;
-- 
1.8.3.2

